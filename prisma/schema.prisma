generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Provider {
  Google
}

enum Plan {
  FREE
  PRO
  ENTERPRISE
}

enum LeadStatus {
  New
  Contacted
  Qualified
  Proposal
  ClosedWon
  ClosedLost
}

enum WorkflowTrigger {
  NewLead
  DealStageChanged
  DealWon
}

enum WorkflowAction {
  AssignOwner
  SendEmail
  CreateTask
  NotifyManager
}

model User {
  id    String  @id @default(uuid())
  email String  @unique
  name  String?
  image String?
  leads Lead[]

  plan        Plan @default(FREE)
  clientLimit Int  @default(10)

  // Leads
  ownedLeads Lead[] @relation("OwnerLeads")
  userLeads  Lead[] @relation("UserLeads")

  // Deals
  ownedDeals Deal[] @relation("OwnerDeals") // deals this user owns
  deals      Deal[] @relation("UserDeals") // deals created by this user

  createdAt      DateTime         @default(now())
  Workflow       Workflow[]
  AutomationStat AutomationStat[]
  Payment        Payment[]
}

model Deal {
  id     String     @id @default(uuid())
  name   String
  amount Float
  stage  LeadStatus
  email  String?

  // Owner of the deal (salesperson)
  ownerId String
  owner   User   @relation("OwnerDeals", fields: [ownerId], references: [id])

  // Which user created this deal
  userId String
  user   User   @relation("UserDeals", fields: [userId], references: [id])

  leadId String?
  lead   Lead?   @relation(fields: [leadId], references: [id])

  createdAt DateTime @default(now())
}

model Lead {
  id    String  @id @default(uuid())
  name  String
  email String
  phone String?

  ownerId String
  owner   User   @relation("OwnerLeads", fields: [ownerId], references: [id])

  userId String
  user   User   @relation("UserLeads", fields: [userId], references: [id])

  status LeadStatus @default(New)
  deals  Deal[]

  createdAt DateTime @default(now())
}

model Workflow {
  id      String          @id @default(uuid())
  name    String
  trigger WorkflowTrigger
  active  Boolean         @default(true)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  actions WorkflowAction[]

  createdAt DateTime @default(now())
}

model AutomationStat {
  id      String          @id @default(uuid())
  name    String
  trigger WorkflowTrigger
  success Int
  status  String

  userId String
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
}

model Payment {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  plan     Plan
  amount   Float
  provider String
  status   String

  createdAt DateTime @default(now())
}
